#!/usr/bin/env bash

set -euo pipefail

PLIST="$HOME/Library/LaunchAgents/com.chezmoi.mac-dotfiles.maintenance.plist"

if [[ ! -f "$PLIST" ]]; then
    echo "âš ï¸  Maintenance LaunchAgent plist not found at $PLIST"
    exit 0
fi

echo "ðŸ¤– Enabling daily maintenance LaunchAgent..."

launchctl bootout "gui/$(id -u)/com.chezmoi.mac-dotfiles.maintenance" 2>/dev/null || true
launchctl bootstrap "gui/$(id -u)" "$PLIST"
launchctl enable "gui/$(id -u)/com.chezmoi.mac-dotfiles.maintenance"

echo "âœ… LaunchAgent enabled: com.chezmoi.mac-dotfiles.maintenance"
echo "   Schedule: every day at 04:00 + at login"
