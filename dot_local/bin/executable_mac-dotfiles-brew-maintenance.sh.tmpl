#!/usr/bin/env bash

set -euo pipefail

run_brew_maintenance() {
    if ! command -v brew >/dev/null 2>&1; then
        echo "âš ï¸  Homebrew not installed, skipping"
        return 0
    fi

    echo "ðŸ“¦ Updating Homebrew..."
    brew update

    echo "â¬†ï¸  Upgrading formulae..."
    brew upgrade

    echo "â¬†ï¸  Upgrading casks..."
    brew upgrade --cask --greedy

    echo "ðŸ§¹ Cleaning up old versions..."
    brew cleanup -s

    echo "ðŸ” Running diagnostics..."
    if ! brew doctor; then
        echo "âš ï¸  brew doctor reported issues. Review the logs/output above."
    fi

    echo "ðŸ“Š Cache statistics:"
    du -sh "$(brew --cache)" 2>/dev/null || echo "Cache empty"

    return 0
}

if [[ "${BASH_SOURCE[0]}" == "$0" ]]; then
    run_brew_maintenance
fi
